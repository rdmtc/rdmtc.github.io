(window.webpackJsonp=window.webpackJsonp||[]).push([[74],{198:function(e,t,i){"use strict";i.r(t);var n={props:["slot-key"],mounted:function(){this.$nextTick(function(){this.$vuepress.$emit("AsyncMarkdownContentMounted",this.slotKey)})}},r=i(6),a=Object(r.a)(n,function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("ContentSlotsDistributor",{attrs:{"slot-key":e.slotKey}},[i("h1",{attrs:{id:"redmatic-homekit"}},[i("a",{staticClass:"header-anchor",attrs:{href:"#redmatic-homekit","aria-hidden":"true"}},[e._v("#")]),e._v(" RedMatic HomeKit")]),e._v(" "),i("p",[e._v("Bitte einen "),i("a",{attrs:{href:"https://github.com/hobbyquaker/RedMatic-HomeKit/issues",target:"_blank",rel:"noopener noreferrer"}},[e._v("Issue anlegen"),i("OutboundLink")],1),e._v(" falls ein Ger√§t nicht unterst√ºtzt wird und gew√ºnscht ist. Die bereits unterst√ºtzen Ger√§te sind hier ersichtlich: https://github.com/hobbyquaker/RedMatic-HomeKit/tree/master/homematic-devices")]),e._v(" "),i("h2",{attrs:{id:"inhalt"}},[i("a",{staticClass:"header-anchor",attrs:{href:"#inhalt","aria-hidden":"true"}},[e._v("#")]),e._v(" Inhalt")]),e._v(" "),i("ul",[i("li",[i("a",{attrs:{href:"#installation"}},[e._v("Installation")])]),e._v(" "),i("li",[i("a",{attrs:{href:"#einrichtung"}},[e._v("Einrichtung")])]),e._v(" "),i("li",[i("a",{attrs:{href:"#nutzungshinweise"}},[e._v("Nutzungshinweise")])]),e._v(" "),i("li",[i("a",{attrs:{href:"#tasten"}},[e._v("Homematic Fernbedienungen/Tasten in HomeKit nutzen")])]),e._v(" "),i("li",[i("a",{attrs:{href:"#systemvariablen"}},[e._v("Systemvariablen")])]),e._v(" "),i("li",[i("a",{attrs:{href:"#programme"}},[e._v("CCU Programme starten")])]),e._v(" "),i("li",[i("a",{attrs:{href:"#universal-accessory"}},[e._v("Universelles Accessory, Einbinden von nicht-Homematic Ger√§ten")]),e._v(" "),i("ul",[i("li",[i("a",{attrs:{href:"#beispiel-contactsensor"}},[e._v("Beispiel ContactSensor")])]),e._v(" "),i("li",[i("a",{attrs:{href:"#beispiel-temperaturesensor"}},[e._v("Beispiel TemperatureSensor")])])])]),e._v(" "),i("li",[i("a",{attrs:{href:"#camera-accessory"}},[e._v("Camera Accessory, einbinden von Kameras")])]),e._v(" "),i("li",[i("a",{attrs:{href:"#reset"}},[e._v("HomeKit Reset")])])]),e._v(" "),i("h2",{attrs:{id:"installation"}},[i("a",{staticClass:"header-anchor",attrs:{href:"#installation","aria-hidden":"true"}},[e._v("#")]),e._v(" Installation")]),e._v(" "),i("p",[e._v('Im RedMatic UI (Erreichbar im CCU WebUI unter Einstellungen->Systemsteuerung) im Tab "Pakete" bei RedMatic-HomeKit auf den Install Button klicken, danach Node-RED neustarten.\n'),i("img",{attrs:{src:"images/homekit/homekit-install.png",alt:""}})]),e._v(" "),i("h2",{attrs:{id:"einrichtung"}},[i("a",{staticClass:"header-anchor",attrs:{href:"#einrichtung","aria-hidden":"true"}},[e._v("#")]),e._v(" Einrichtung")]),e._v(" "),i("p",[e._v("Den Node "),i("em",[e._v("RedMatic HomeKit - Homematic")]),e._v(" per Drag&Drop einem Flow hinzuf√ºgen"),i("br"),e._v(" "),i("img",{attrs:{src:"images/homekit/homekit1.png",alt:""}})]),e._v(" "),i("p",[e._v("Die Konfiguration des neu hinzugef√ºgten Node per Doppelklick √∂ffnen, den Button mit dem Bleistift-Icon anklicken um eine neue Bridge hinzuzuf√ºgen"),i("br"),e._v(" "),i("img",{attrs:{src:"images/homekit/homekit2.png",alt:""}})]),e._v(" "),i("p",[e._v("Die Standardeinstellungen k√∂nnen beibehalten werden, mit einem Klick auf den Button "),i("em",[e._v("Add")]),e._v(" wird die Bridge angelegt"),i("br"),e._v(" "),i("img",{attrs:{src:"images/homekit/homekit3.png",alt:""}})]),e._v(" "),i("p",[e._v("Die Konfiguration des "),i("em",[e._v("RedMatic HomeKit - Homematic")]),e._v(" mit klick auf "),i("em",[e._v("Done")]),e._v(" verlassen und dann den Button "),i("em",[e._v("Deploy")]),e._v(" anklicken"),i("br"),e._v(" "),i("img",{attrs:{src:"images/homekit/homekit4.png",alt:""}})]),e._v(" "),i("p",[e._v("Nochmals die Konfiguration des "),i("em",[e._v("RedMatic HomeKit - Homematic")]),e._v(" Node per Doppelklick √∂ffnen und nochmal √ºber den Bleistift-Button die Bridge-Konfiguration √∂ffnen"),i("br"),e._v(" "),i("img",{attrs:{src:"images/homekit/homekit5.png",alt:""}})]),e._v(" "),i("p",[e._v("Bei einer erfolgreich aktivierten Bridge wird in dem Bridge Konfigurationsdialog nun ein QR-Code angezeigt"),i("br"),e._v(" "),i("img",{attrs:{src:"images/homekit/homekit6.png",alt:""}})]),e._v(" "),i("h4",{attrs:{id:"ccu-firewall"}},[i("a",{staticClass:"header-anchor",attrs:{href:"#ccu-firewall","aria-hidden":"true"}},[e._v("#")]),e._v(" CCU-Firewall")]),e._v(" "),i("p",[e._v("Der in der Bridge-Konfiguration angegebene Port (Default: "),i("code",[e._v("51826")]),e._v(") und der Port f√ºr den mDNS Dienst ("),i("code",[e._v("5353")]),e._v(') m√ºssen in der CCU Firewall freigegeben werden (falls diese √ºber die Firewall-Richtlinie "Ports blockiert" aktiviert ist).\n'),i("img",{attrs:{src:"images/homekit/homekit-firewall.png",alt:""}})]),e._v(" "),i("p",[e._v("In der Home App oben rechts √ºber den Plus-Button ein neues Ger√§t hinzuf√ºgen, den QR-Code vom Bildschirm abscannen"),i("br"),e._v(" "),i("img",{attrs:{src:"images/homekit/homekit7.png",alt:""}})]),e._v(" "),i("p",[e._v("Die Sicherheitswarnung best√§tigen"),i("br"),e._v(" "),i("img",{attrs:{src:"images/homekit/homekit8.png",alt:""}})]),e._v(" "),i("p",[e._v("Nun sollten alle unterst√ºtzen Ger√§te der CCU in der Home App erscheinen.")]),e._v(" "),i("p",[i("strong",[e._v("Achtung")]),e._v(": Wenn keine Ger√§te f√ºr HomeKit aktiviert sind (weil z.B. noch gar keine Ger√§te an der CCU angelernt sind oder die Checkboxen f√ºr die Ger√§te alle deaktiviert wurden) wird die Bridge nicht ver√∂ffentlicht und es erscheint "),i("em",[e._v("kein")]),e._v(" QR-Code.")]),e._v(" "),i("h3",{attrs:{id:"nutzungshinweise"}},[i("a",{staticClass:"header-anchor",attrs:{href:"#nutzungshinweise","aria-hidden":"true"}},[e._v("#")]),e._v(" Nutzungshinweise")]),e._v(" "),i("p",[e._v("Nicht alle √Ñnderungen an den in HomeKit bereitgestellten Accessories werden bei einem Deploy in Node-RED √ºbernommen. "),i("strong",[e._v("Bestimmte √Ñnderungen erfordern nach dem Deploy einen Neustart von RedMatic")]),e._v(":")]),e._v(" "),i("ul",[i("li",[e._v("Entfernen von Ger√§ten")]),e._v(" "),i("li",[e._v("Umbenennen von Ger√§ten")]),e._v(" "),i("li",[e._v("Konfigurations√§nderung an Ger√§ten (z.B. entfernen des Boost Switch bei Thermostaten)")]),e._v(" "),i("li",[e._v("√Ñndern der Anzahl der Tasten des Event Nodes")]),e._v(" "),i("li",[e._v('Die konfigurierten Services eines "Universellen Accessory" √§ndern')])]),e._v(" "),i("h3",{attrs:{id:"tasten"}},[i("a",{staticClass:"header-anchor",attrs:{href:"#tasten","aria-hidden":"true"}},[e._v("#")]),e._v(" Tasten")]),e._v(" "),i("p",[e._v("Zum Ausl√∂sen von Aktionen in HomeKit √ºber Homematic Fernbedienungen/Taster kann der Node "),i("em",[e._v("RedMatic HomeKit - Event")]),e._v(" genutzt werden. Er erwartet an seinem Eingang eine Message die in "),i("code",[e._v("msg.topic")]),e._v(" die zu dr√ºckende Taste und die Art des Tastendrucks (kurz/lang) enth√§lt, z.B. "),i("code",[e._v("1/PRESS_LONG")]),e._v(" f√ºr einen langen Tastendruck auf Taste 1. Dieses Topic kann direkt vom RPC Event Node erzeugt werden in dem man die Topic-Konfiguration auf "),i("code",[e._v("${channelIndex}/${datapoint}")]),e._v(" setzt und den Datenpunkt mit dem regul√§ren Ausdruck "),i("code",[e._v("PRESS_SHORT|PRESS_LONG")]),e._v(" filtert:")]),e._v(" "),i("p",[i("img",{attrs:{src:"images/homekit/fernbedienung.png",alt:""}})]),e._v(" "),i("h3",{attrs:{id:"systemvariablen"}},[i("a",{staticClass:"header-anchor",attrs:{href:"#systemvariablen","aria-hidden":"true"}},[e._v("#")]),e._v(" Systemvariablen")]),e._v(" "),i("p",[e._v("(Boolsche) Systemvariablen k√∂nnen √ºber den "),i("em",[e._v("Redmatic HomeKit - Switch")]),e._v(" Node in HomeKit bereitgestellt werden. Hierzu werden die Ein- und Ausg√§nge eines "),i("em",[e._v("CCU Sysvar")]),e._v(" Nodes √ºber kreuz mit dem "),i("em",[e._v("Redmatic HomeKit - Switch")]),e._v(" Node verbunden")]),e._v(" "),i("p",[i("img",{attrs:{src:"images/homekit/homekit-sysvar.png",alt:""}})]),e._v(" "),i("h3",{attrs:{id:"programme"}},[i("a",{staticClass:"header-anchor",attrs:{href:"#programme","aria-hidden":"true"}},[e._v("#")]),e._v(" Programme")]),e._v(" "),i("p",[e._v("Leider werden bisher von der Home App und Siri keine Taster unterst√ºtzt die einen Einmaligen Event erzeugen. Als Workaround steht mit dem "),i("em",[e._v("redmatic homekit - button")]),e._v(' Node ein Schalter zur Verf√ºgung der sich automatisch nach dem Anschalten zur√ºcksetzt und so als "Pseudobutton" genutzt werden kann.')]),e._v(" "),i("p",[e._v("Dieser kann einfach mit einem "),i("em",[e._v("ccu - program")]),e._v(" Node verbunden werden, als "),i("em",[e._v("Payload")]),e._v(" wird "),i("code",[e._v("timestamp")]),e._v(" ausgew√§hlt:")]),e._v(" "),i("p",[i("img",{attrs:{src:"images/homekit/homekit-pseudobutton.png",alt:""}})]),e._v(" "),i("h3",{attrs:{id:"universal-accessory"}},[i("a",{staticClass:"header-anchor",attrs:{href:"#universal-accessory","aria-hidden":"true"}},[e._v("#")]),e._v(" Universal Accessory")]),e._v(" "),i("p",[e._v("Mit dem Universal Accessory ist es m√∂glich beliebige HomeKit-Ger√§te zu erzeugen, z.B. um damit auch Ger√§te abseits von Homematic einzubinden.")]),e._v(" "),i("p",[e._v("Dem Accessory k√∂nnen beliebig viele Services hinzugef√ºgt werden. Siehe dazu auch https://github.com/rdmtc/RedMatic-HomeKit/issues/44")]),e._v(" "),i("p",[e._v("Verf√ºgbare Services sowie die daf√ºr ben√∂tigten und optionalen Characteristiken sind in dieser Datei ersichtlich: https://github.com/KhaosT/HAP-NodeJS/blob/master/src/lib/gen/HomeKit.ts")]),e._v(" "),i("p",[e._v("Um eine optionale Characteristic anzulegen m√ºssen dem Accessory direkt beim Start (z.B. √ºber einen "),i("em",[e._v("Inject")]),e._v(" Node) Messages gesendet werden.")]),e._v(" "),i("h4",{attrs:{id:"beispiel-contactsensor"}},[i("a",{staticClass:"header-anchor",attrs:{href:"#beispiel-contactsensor","aria-hidden":"true"}},[e._v("#")]),e._v(" Beispiel ContactSensor")]),e._v(" "),i("p",[e._v("Es soll ein Accessory mit einem "),i("em",[e._v("ContactSensor")]),e._v(" Service angelegt werden. Die "),i("code",[e._v("0")]),e._v(' vor dem Service gibt den "Subtype" an, dieser wird sp√§ter ben√∂tigt um diesen Service anzusprechen.')]),e._v(" "),i("p",[i("img",{attrs:{src:"images/homekit/universal-2.png",alt:""}})]),e._v(" "),i("p",[e._v("Aus https://github.com/KhaosT/HAP-NodeJS/blob/master/src/lib/gen/HomeKit.ts ist ersichtlich dass der Service "),i("em",[e._v("ContactSensor")]),e._v(" eine Charakteristik "),i("em",[e._v("ContactSensorState")]),e._v(" ben√∂tigt:")]),e._v(" "),i("p",[i("img",{attrs:{src:"images/homekit/universal-6.png",alt:""}})]),e._v(" "),i("p",[e._v("In der Definition dieser Charakteristik ist ersichtlich dass diese den Wert "),i("code",[e._v("0")]),e._v(" annehmen muss um einen geschlossenen Kontakt zu signalisieren und den Wert "),i("code",[e._v("1")]),e._v(" um einen offenen Kontakt zu melden:")]),e._v(" "),i("p",[i("img",{attrs:{src:"images/homekit/universal-5.png",alt:""}})]),e._v(" "),i("p",[e._v("Um nun einen geschlossenen Kontakt zu melden muss dem Node eine Message geschickt werden deren "),i("code",[e._v("msg.topic")]),e._v(' Property sich durch den "Subtype" (siehe oben) und den Namen der Characteristik zusammensetzt, getrennt durch einen Slash: '),i("code",[e._v("0/ContactSensorState")]),e._v(".\nDie Property "),i("code",[e._v("msg.payload")]),e._v(" muss in diesem Fall auf die Number "),i("code",[e._v("0")]),e._v(" gesetzt werden. Um diese beiden Properties der Message zu setzen kann ein "),i("em",[e._v("Change")]),e._v(" Node genutzt werden:")]),e._v(" "),i("p",[i("img",{attrs:{src:"images/homekit/universal-3.png",alt:""}})]),e._v(" "),i("p",[i("img",{attrs:{src:"images/homekit/universal-1.png",alt:""}})]),e._v(" "),i("h5",{attrs:{id:"flow-json"}},[i("a",{staticClass:"header-anchor",attrs:{href:"#flow-json","aria-hidden":"true"}},[e._v("#")]),e._v(" Flow JSON")]),e._v(" "),i("div",{staticClass:"language- line-numbers-mode"},[i("pre",{pre:!0,attrs:{class:"language-text"}},[i("code",[e._v('[{"id":"f3c1ee32.c1bdf","type":"redmatic-homekit-universal","z":"e679be4e.ea888","bridgeConfig":"505f657d.84710c","name":"ContactSensor","services":[{"subtype":"0","service":"ContactSensor","name":"Test"}],"x":580,"y":240,"wires":[[]]},{"id":"26ae9d08.5d6242","type":"change","z":"e679be4e.ea888","name":"CONTACT_DETECTED","rules":[{"t":"set","p":"payload","pt":"msg","to":"0","tot":"num"},{"t":"set","p":"topic","pt":"msg","to":"0/ContactSensorState","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":340,"y":220,"wires":[["f3c1ee32.c1bdf","55fcb00d.f7a66"]]},{"id":"70eea6a6.faf3f8","type":"change","z":"e679be4e.ea888","name":"CONTACT_NOT_DETECTED","rules":[{"t":"set","p":"payload","pt":"msg","to":"1","tot":"num"},{"t":"set","p":"topic","pt":"msg","to":"0/ContactSensorState","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":320,"y":260,"wires":[["f3c1ee32.c1bdf","55fcb00d.f7a66"]]},{"id":"92689c97.a698c","type":"inject","z":"e679be4e.ea888","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":100,"y":220,"wires":[["26ae9d08.5d6242"]]},{"id":"7cbf7fe8.59d9","type":"inject","z":"e679be4e.ea888","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":100,"y":260,"wires":[["70eea6a6.faf3f8"]]},{"id":"55fcb00d.f7a66","type":"debug","z":"e679be4e.ea888","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":560,"y":320,"wires":[]},{"id":"505f657d.84710c","type":"redmatic-homekit-bridge","z":"","name":"RedMatic Test Bridge","username":"CC:22:3D:00:F6:05","pincode":"964-84-514","port":"51826"}]\n')])]),e._v(" "),i("div",{staticClass:"line-numbers-wrapper"},[i("span",{staticClass:"line-number"},[e._v("1")]),i("br")])]),i("h4",{attrs:{id:"beispiel-temperaturesensor"}},[i("a",{staticClass:"header-anchor",attrs:{href:"#beispiel-temperaturesensor","aria-hidden":"true"}},[e._v("#")]),e._v(" Beispiel TemperatureSensor")]),e._v(" "),i("h3",{attrs:{id:"camera-accessory"}},[i("a",{staticClass:"header-anchor",attrs:{href:"#camera-accessory","aria-hidden":"true"}},[e._v("#")]),e._v(" Camera Accessory")]),e._v(" "),i("p",[e._v("Anleitung von nicolas-eric: https://github.com/rdmtc/RedMatic/wiki/Homekit-Kamera-einbinden")]),e._v(" "),i("p",[e._v("Siehe auch:")]),e._v(" "),i("ul",[i("li",[e._v("https://github.com/rdmtc/RedMatic-HomeKit/issues/125#issuecomment-466550728")]),e._v(" "),i("li",[i("a",{attrs:{href:"https://homematic-forum.de/forum/viewtopic.php?f=77&t=50935",target:"_blank",rel:"noopener noreferrer"}},[e._v("Homematic-Forum - Homekit Popup Bild bei Bewegung"),i("OutboundLink")],1)])]),e._v(" "),i("h3",{attrs:{id:"reset"}},[i("a",{staticClass:"header-anchor",attrs:{href:"#reset","aria-hidden":"true"}},[e._v("#")]),e._v(" Reset")]),e._v(" "),i("p",[e._v('Um die Bridge im Fall von schwerwiegenden Problemen ("sollte" nicht passieren, aber man weiss ja nie üòâ) komplett zur√ºckzusetzen kann wie folgt vorgegangen werden:')]),e._v(" "),i("ul",[i("li",[e._v("Bridge in iOS Home App l√∂schen")]),e._v(" "),i("li",[e._v("RedMatic stoppen")]),e._v(" "),i("li",[e._v("Auf der CCU das Verzeichnis "),i("code",[e._v("/usr/local/addons/redmatic/var/homekit")]),e._v(" mitsamt Inhalt l√∂schen")]),e._v(" "),i("li",[e._v("RedMatic starten")])]),e._v(" "),i("p",[e._v("Hierbei gehen alle Raum-Zuordnungen sowie Umbenennungen in HomeKit verloren!")])])},[],!1,null,null,null);a.options.__file="Homekit.md";t.default=a.exports}}]);